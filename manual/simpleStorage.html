<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../">
  <title data-ice="title">Manual | wootils</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="A set of Javascript utilities for building Node and browser apps."><meta property="twitter:card" content="summary"><meta property="twitter:title" content="wootils"><meta property="twitter:description" content="A set of Javascript utilities for building Node and browser apps."></head>
<body class="layout-container manual-root" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  <a href="./manual/index.html" data-ice="manualHeaderLink">Manual</a>
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/homer0/wootils"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div class="manual-toc-root">
  
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/appConfiguration.html"><a href="manual/appConfiguration.html" data-ice="link">AppConfiguration</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/appConfiguration.html"><a href="manual/appConfiguration.html#example" data-ice="link">Example</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/appConfiguration.html"><a href="manual/appConfiguration.html#without-jimple" data-ice="link">Without Jimple</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/appConfiguration.html"><a href="manual/appConfiguration.html#with-jimple" data-ice="link">With Jimple</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/appConfiguration.html"><a href="manual/appConfiguration.html#features" data-ice="link">Features</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/appConfiguration.html"><a href="manual/appConfiguration.html#loading-configurations-dynamically" data-ice="link">Loading configurations dynamically</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/appConfiguration.html"><a href="manual/appConfiguration.html#using-it-without-environment-variables-" data-ice="link">Using it without environment variables.</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/appConfiguration.html"><a href="manual/appConfiguration.html#extending-configurations" data-ice="link">Extending configurations</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/appConfiguration.html"><a href="manual/appConfiguration.html#get-and-set" data-ice="link">Get and Set</a></li>
<li data-ice="manualNav" class="indent-h4" data-link="manual/appConfiguration.html"><a href="manual/appConfiguration.html#reading" data-ice="link">Reading</a></li>
<li data-ice="manualNav" class="indent-h4" data-link="manual/appConfiguration.html"><a href="manual/appConfiguration.html#writing" data-ice="link">Writing</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/appConfiguration.html"><a href="manual/appConfiguration.html#switching-configurations-while-the-app-is-running" data-ice="link">Switching configurations while the app is running</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/appConfiguration.html"><a href="manual/appConfiguration.html#technical-documentation" data-ice="link">Technical documentation</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/environmentUtils.html"><a href="manual/environmentUtils.html" data-ice="link">EnvironmentUtils</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/environmentUtils.html"><a href="manual/environmentUtils.html#example" data-ice="link">Example</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/environmentUtils.html"><a href="manual/environmentUtils.html#without-jimple" data-ice="link">Without Jimple</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/environmentUtils.html"><a href="manual/environmentUtils.html#with-jimple" data-ice="link">With Jimple</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/environmentUtils.html"><a href="manual/environmentUtils.html#features" data-ice="link">Features</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/environmentUtils.html"><a href="manual/environmentUtils.html#reading-variables" data-ice="link">Reading variables</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/environmentUtils.html"><a href="manual/environmentUtils.html#checking-the-environment" data-ice="link">Checking the environment</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/environmentUtils.html"><a href="manual/environmentUtils.html#technical-documentation" data-ice="link">Technical documentation</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/errorHandler.html"><a href="manual/errorHandler.html" data-ice="link">ErrorHandler</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/errorHandler.html"><a href="manual/errorHandler.html#example" data-ice="link">Example</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/errorHandler.html"><a href="manual/errorHandler.html#without-jimple" data-ice="link">Without Jimple</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/errorHandler.html"><a href="manual/errorHandler.html#with-jimple" data-ice="link">With Jimple</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/errorHandler.html"><a href="manual/errorHandler.html#technical-documentation" data-ice="link">Technical documentation</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/logger.html"><a href="manual/logger.html" data-ice="link">Logger</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/logger.html"><a href="manual/logger.html#example" data-ice="link">Example</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/logger.html"><a href="manual/logger.html#without-jimple" data-ice="link">Without Jimple</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/logger.html"><a href="manual/logger.html#with-jimple" data-ice="link">With Jimple</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/logger.html"><a href="manual/logger.html#features" data-ice="link">Features</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/logger.html"><a href="manual/logger.html#colored-messages" data-ice="link">Colored messages</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/logger.html"><a href="manual/logger.html#multiple-messages-at-once" data-ice="link">Multiple messages at once</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/logger.html"><a href="manual/logger.html#prefix" data-ice="link">Prefix</a></li>
<li data-ice="manualNav" class="indent-h4" data-link="manual/logger.html"><a href="manual/logger.html#without-jimple" data-ice="link">Without Jimple</a></li>
<li data-ice="manualNav" class="indent-h4" data-link="manual/logger.html"><a href="manual/logger.html#with-jimple" data-ice="link">With Jimple</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/logger.html"><a href="manual/logger.html#date-and-time" data-ice="link">Date and Time</a></li>
<li data-ice="manualNav" class="indent-h4" data-link="manual/logger.html"><a href="manual/logger.html#without-jimple" data-ice="link">Without Jimple</a></li>
<li data-ice="manualNav" class="indent-h4" data-link="manual/logger.html"><a href="manual/logger.html#with-jimple" data-ice="link">With Jimple</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/logger.html"><a href="manual/logger.html#applogger" data-ice="link">appLogger</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/logger.html"><a href="manual/logger.html#technical-documentation" data-ice="link">Technical documentation</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/packageInfo.html"><a href="manual/packageInfo.html" data-ice="link">packageInfo</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/packageInfo.html"><a href="manual/packageInfo.html#example" data-ice="link">Example</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/packageInfo.html"><a href="manual/packageInfo.html#without-jimple" data-ice="link">Without Jimple</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/packageInfo.html"><a href="manual/packageInfo.html#with-jimple" data-ice="link">With Jimple</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/packageInfo.html"><a href="manual/packageInfo.html#technical-documentation" data-ice="link">Technical documentation</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/pathUtils.html"><a href="manual/pathUtils.html" data-ice="link">PathUtils</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/pathUtils.html"><a href="manual/pathUtils.html#example" data-ice="link">Example</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/pathUtils.html"><a href="manual/pathUtils.html#without-jimple" data-ice="link">Without Jimple</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/pathUtils.html"><a href="manual/pathUtils.html#with-jimple" data-ice="link">With Jimple</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/pathUtils.html"><a href="manual/pathUtils.html#features" data-ice="link">Features</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/pathUtils.html"><a href="manual/pathUtils.html#build-paths-relative-to-the-project-root-directory" data-ice="link">Build paths relative to the project root directory</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/pathUtils.html"><a href="manual/pathUtils.html#multiple-locations" data-ice="link">Multiple locations</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/pathUtils.html"><a href="manual/pathUtils.html#technical-documentation" data-ice="link">Technical documentation</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/rootRequire.html"><a href="manual/rootRequire.html" data-ice="link">rootRequire</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/rootRequire.html"><a href="manual/rootRequire.html#example" data-ice="link">Example</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/rootRequire.html"><a href="manual/rootRequire.html#without-jimple" data-ice="link">Without Jimple</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/rootRequire.html"><a href="manual/rootRequire.html#with-jimple" data-ice="link">With Jimple</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/rootRequire.html"><a href="manual/rootRequire.html#technical-documentation" data-ice="link">Technical documentation</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/APIClient.html"><a href="manual/APIClient.html" data-ice="link">APIClient</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/APIClient.html"><a href="manual/APIClient.html#examples" data-ice="link">Examples</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/APIClient.html"><a href="manual/APIClient.html#features" data-ice="link">Features</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/APIClient.html"><a href="manual/APIClient.html#configurable-endpoints" data-ice="link">Configurable endpoints</a></li>
<li data-ice="manualNav" class="indent-h4" data-link="manual/APIClient.html"><a href="manual/APIClient.html#endpoint-objects" data-ice="link">Endpoint objects</a></li>
<li data-ice="manualNav" class="indent-h4" data-link="manual/APIClient.html"><a href="manual/APIClient.html#sub-collections-of-endpoints" data-ice="link">Sub collections of endpoints</a></li>
<li data-ice="manualNav" class="indent-h4" data-link="manual/APIClient.html"><a href="manual/APIClient.html#built-in-request-methods" data-ice="link">Built-in request methods</a></li>
<li data-ice="manualNav" class="indent-h4" data-link="manual/APIClient.html"><a href="manual/APIClient.html#default-headers" data-ice="link">Default headers</a></li>
<li data-ice="manualNav" class="indent-h4" data-link="manual/APIClient.html"><a href="manual/APIClient.html#authorization-token" data-ice="link">Authorization token</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/APIClient.html"><a href="manual/APIClient.html#technical-documentation" data-ice="link">Technical documentation</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/deferred.html"><a href="manual/deferred.html" data-ice="link">deferred</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/deferred.html"><a href="manual/deferred.html#example" data-ice="link">Example</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/deferred.html"><a href="manual/deferred.html#technical-documentation" data-ice="link">Technical documentation</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/eventsHub.html"><a href="manual/eventsHub.html" data-ice="link">EventsHub</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/eventsHub.html"><a href="manual/eventsHub.html#examples" data-ice="link">Examples</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/eventsHub.html"><a href="manual/eventsHub.html#listen-and-emit" data-ice="link">Listen and emit</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/eventsHub.html"><a href="manual/eventsHub.html#reduce-a-variable" data-ice="link">Reduce a variable</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/eventsHub.html"><a href="manual/eventsHub.html#technical-documentation" data-ice="link">Technical documentation</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/objectUtils.html"><a href="manual/objectUtils.html" data-ice="link">ObjectUtils</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/objectUtils.html"><a href="manual/objectUtils.html#examples" data-ice="link">Examples</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/objectUtils.html"><a href="manual/objectUtils.html#-code-merge--code-" data-ice="link">merge</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/objectUtils.html"><a href="manual/objectUtils.html#-code-copy--code-" data-ice="link">copy</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/objectUtils.html"><a href="manual/objectUtils.html#-code-get--code-" data-ice="link">get</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/objectUtils.html"><a href="manual/objectUtils.html#-code-set--code-" data-ice="link">set</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/objectUtils.html"><a href="manual/objectUtils.html#-code-extract--code-" data-ice="link">extract</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/objectUtils.html"><a href="manual/objectUtils.html#-code-delete--code-" data-ice="link">delete</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/objectUtils.html"><a href="manual/objectUtils.html#technical-documentation" data-ice="link">Technical documentation</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/simpleStorage.html"><a href="manual/simpleStorage.html" data-ice="link">SimpleStorage</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/simpleStorage.html"><a href="manual/simpleStorage.html#examples" data-ice="link">Examples</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/simpleStorage.html"><a href="manual/simpleStorage.html#basic" data-ice="link">Basic</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/simpleStorage.html"><a href="manual/simpleStorage.html#working-with-entries" data-ice="link">Working with entries</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/simpleStorage.html"><a href="manual/simpleStorage.html#technical-documentation" data-ice="link">Technical documentation</a></li>
</ul>
  </div>
</div>
</nav>

<div class="content" data-ice="content"><div class="github-markdown" data-ice="content"><h1 id="simplestorage">SimpleStorage</h1><p>An <strong>abstract</strong> class allows you to build services that relay on browser storage (session/local) and simplifies the way you work it.</p>
<p>The class doesn&apos;t have any public method, as the idea is for you to define your (let&apos;s call it) <em>&quot;service&quot;</em> and then interact with the storage internally, using the <em>protected</em> methods.</p>
<h2 id="examples">Examples</h2><h3 id="basic">Basic</h3><p>Let&apos;s say you have an app with a form for writing blog posts (or any kind of articles), and it has two fields: title and content.</p>
<p>The basic functionality is ready, when the user hits the <code>Save</code> button, you send the post to an API in order to publish. We can imagine a service like this:</p>
<pre><code class="lang-js"><code class="source-code prettyprint">class Posts {
  save(title, content) {
    return fetch(...);
  }
}</code>
</code></pre>
<p>But, what if we want to add a feature to save a draft of the post while the user is writing? in case something happens, we can prevent the user from losing what he/she wrote.</p>
<p>We can use <code>localStorage</code>! we need to write the functions to:</p>
<ol>
<li>Save the draft, encoded as JSON.</li>
<li>Load the storage, check for the draft, decode it and restore.</li>
</ol>
<p>And that&apos;s exactly what <code>SimpleStorage</code> can do for you:</p>
<pre><code class="lang-js"><code class="source-code prettyprint">const SimpleStorage = require(&apos;wootils/browser/simpleStorage&apos;);

class Posts extends SimpleStorage {
  constructor(...) {
    super({
      storage: {
        name: &apos;posts&apos;,
        key: &apos;myApp-posts&apos;,
      },
    });
  }

  saveDraft(title, content) {
    this._setData({ title, content });
  }

  getDraft() {
    const draft = this._getData();
    return draft.title ? draft : null;
  }

  save(title, content) {
    this._delete();
    return fetch(...);
  }
}</code>
</code></pre>
<p>Let&apos;s go over all the changes:</p>
<p>We first <code>require</code>/<code>import</code> the class and make <code>Posts</code> extend from it.</p>
<p>Then we use the constructor options to specify the name and key for the storage. The name is just a reference the class uses and the key is the actual key that will be used on the storage to save the data.</p>
<blockquote>
<p>Since we wanted <code>localStorage</code>, we don&apos;t need to touch any other default option, but if you are interested on the default options, take a look at the technical documentation for the class.</p>
</blockquote>
<p>We add <code>saveDraft</code> and <code>getDraft</code>: As you can imagine, <code>saveDraft</code> just tells the class to save an object, and based on the storage options, the class already knows that the object should be encoded as a JSON before saving it, no need to worry about that.</p>
<p><code>getDraft</code> will just try to obtain the data and make sure there&apos;s a draft there; the whole process where the class checks the storage and loads its contents has been already taken care of.</p>
<p>The reason we check for <code>.title</code> is because the class will check if there&apos;s something on the storage using the key from the options, and if there&apos;s nothing, it will add an empty object in order to work with future data.</p>
<p>And the last modification is the call to <code>_delete</code> on the <code>save</code> method: We are going to finally save the post, so it&apos;s ok to delete the draft from the storage: this is basically a <em>&quot;clean up&quot;</em>.</p>
<p>Now... there&apos;s a problem with this implementation: we are using <code>localStorage</code>, so if the user is writing different posts on different browser tabs, they&apos;ll overwrite each other (yeah, that seems like an odd scenario, but it may happen).</p>
<p>We should switch to <code>sessionStorage</code> and keep the draft limited to each tab. Doing that with <code>SimpleStorage</code> is quite easy:</p>
<pre><code class="lang-js"><code class="source-code prettyprint">const SimpleStorage = require(&apos;wootils/browser/simpleStorage&apos;);

class Posts extends SimpleStorage {
  constructor(...) {
    super({
      storage: {
        name: &apos;posts&apos;,
        key: &apos;myApp-posts&apos;,
        typePriority: [&apos;session&apos;, &apos;local&apos;],
      },
    });
  }
...</code>
</code></pre>
<p>By adding the <code>storage.typePriority</code> option, we tell the class to use <code>sessionStorage</code> if available and switch to <code>localStorage</code> as a fallback.</p>
<h3 id="working-with-entries">Working with entries</h3><p>On the example above we saw how to save, read and delete a simple object from the storage, but <code>SimpleStorage</code> allows you to also work with different objects: Entries.</p>
<p>When working with entries, instead of just sending an object to the storage, you can have like a <em>&quot;storage inside the storage&quot;</em>, where you can assign different keys for different objects... and even and expiration time for them.</p>
<p>Let&apos;s illustrate this with an example: You have an app that, when a user navigates to <em>&quot;its profile page&quot;</em>, it makes some requests to load some &quot;settings&quot;, like this:</p>
<pre><code class="lang-js"><code class="source-code prettyprint">class Users {
  ...
  getUserProfileSettings(userId) {
    const result = {};
    this.getUserProfile(userId)
    .then((userProfile) =&gt; {
      result.userProfile = userProfile;
      return this.getUserAppSettings(userId);
    })
    .then((appSettings) =&gt; {
      result.appSettings = appSettings;
      return this.getUserUISettings(userId);
    })
    .then((uiSettings) =&gt; {
      result.uiSettings = uiSettings;
      return result;
    })
    .catch(...)
    .then(() =&gt; {
      this._turnOffThatCrazyAjaxLoadIndicator(): // :P
    });
  }

  getUserProfile(userId) {
    return fetch(`/user-profile/${userId}`)
    .then((resp) =&gt; resp.json());
  }

  getUserAppSettings(userId) {
    return fetch(`/user-app-settings/${userId}`)
    .then((resp) =&gt; resp.json());
  }

  getUserUISettings(userId) {
    return fetch(`/user-ui-settings/${userId}`)
    .then((resp) =&gt; resp.json());
  }
}</code>
</code></pre>
<blockquote>
<p>Yes, you could also use <code>async</code>/<code>await</code> or <code>Promise.all</code>, but this is just a simple example.</p>
</blockquote>
<p>But what if we know that it&apos;s hardly possible that those setting would change in the near future and that the app may need to do those requests for more than just the <em>&quot;profile page&quot;</em>?</p>
<p>We can do something like on the example above and store everything on the local storage, right? well... manipulating a single object in order to put the responses of all the different request will require some extra coding and it may seem like an overkill, so, that&apos;s why <code>SimpleStorage</code> has entries.</p>
<p>We can use the entries feature to store each request as a different <em>entry</em>, and even tell the class to just keep them for an 2 hours, after that, make the request again.</p>
<p>Let&apos;s start by adding <code>SimpleStorage</code> and enabling the feature:</p>
<pre><code class="lang-js"><code class="source-code prettyprint">const SimpleStorage = require(&apos;wootils/browser/simpleStorage&apos;);

class Users extends SimpleStorage {
  constructor(...) {
    super({
      storage: {
        name: &apos;user-requests&apos;,
        key: &apos;myApp-user-requests&apos;,
      },
      entries: {
        enabled: true,
        expiration: 7200,
      }
    });
  }
...</code>
</code></pre>
<p>We first <code>require</code>/<code>import</code> the class and make <code>Users</code> extend from it.</p>
<p>Then we use the constructor options to:</p>
<ol>
<li>Specify the name and key for the storage. The name is just a reference the class uses and the key is the actual key that will be used on the storage to save the data.</li>
<li>Enable the feature <code>entries.enabled</code> and set the expiration time of each entry (2 hours, in seconds).</li>
</ol>
<p>Now we need to add a method to cache the requests as entries:</p>
<pre><code class="lang-js"><code class="source-code prettyprint">cacheRequest(url) {
  const entry = this._getEntry(url);
  return entry ?
    Promise.resolve(entry.value) :
    this._saveEntry(fetch(url).then((resp) =&gt; resp.json()));
}</code>
</code></pre>
<p>As you can see, the method first uses <code>_getEntry</code>, to locate an entry for the received URL.</p>
<p>If an entry was found, it uses <code>Promise.resolve</code> to return the value. The reason for returning a <code>Promise</code> is so method will always return a promise even if the request doesn&apos;t fire.</p>
<p>But if there&apos;s no entry, it calls <code>_saveEntry</code> with the result of the <code>fetch</code> request.</p>
<blockquote>
<p>You can send an object or a promise to <code>_saveEntry</code> and <code>_sendData</code>, the class will wait for it to be resolved and <em>then</em> use the received value.</p>
</blockquote>
<p>That&apos;s all for the method; like on the other example, <code>SimpleStorage</code> will take care of writing and reading the entries and their values for the storage.</p>
<p>Time to refactor! We need to change the <em>&quot;get methods&quot;</em> and make them use the new <code>cacheRequest</code>:</p>
<pre><code class="lang-js"><code class="source-code prettyprint">...
getUserProfile(userId) {
  return this.cacheRequest(`/user-profile/${userId}`);
}

getUserAppSettings(userId) {
  return this.cacheRequest(`/user-app-settings/${userId}`);
}

getUserUISettings(userId) {
  return this.cacheRequest(`/user-ui-settings/${userId}`);
}
...</code>
</code></pre>
<p>Done! Now the request will only trigger if there&apos;s nothing on the storage (this includes entries that were deleted because they expired.</p>
<h2 id="technical-documentation">Technical documentation</h2><p>The code is fully documented with <a href="https://esdoc.org">ESDoc</a> and you can either read the generated documentation <a href="https://homer0.github.io/wootils/class/wootils/browser/simpleStorage.js~SimpleStorage.html">online</a> or generate it yourself using:</p>
<pre><code class="lang-bash"><code class="source-code prettyprint"># You can either use npm or yarn, it doesn&apos;t matter
npm run docs
open ./docs/index.html</code>
</code></pre>
</div>
</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
